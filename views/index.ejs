<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Group Chat</title>
        <link rel="stylesheet" href="skeleton.css">
        <link rel="stylesheet" href="style.css">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script type ="text/javascript" src="/socket.io/socket.io.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){

                var socket = io.connect();

                var uID;

                var name;
                // console.log(prompt);
                // if(!prompt){
                //     console.log('here');
                    // User first enters room:
                    name = prompt('What is your name?');
                    socket.emit("got_new_user", {name: name});
                // }else{
                //     console.log('not');
                // }



                //Listeners:
                // new user
                socket.on("new_user", function(data){

                    var id = JSON.stringify(data.uId);
                    var id2 = id.slice(3, -1);

                    $(".users").append("<p class="+id2+">"+data.name+"</p>");
                })

                // existing users
                socket.on("existing_users", function(data){
                    for(var key in data.existing_users){
                        if(data.uID != key){

                            var id = JSON.stringify(key);
                            var id2 = id.slice(3,-1);

                            $(".users").append("<p class='"+id2+"'>"+ data.existing_users[key].name+ "</p>");
                        }
                    }
                })


                $("#message_form").submit(function(e){
                    e.preventDefault();
                    var userID = $("#userID").val();
                    var message = $("#message").val();

                    socket.emit("new_message", {userID: userID, name: name, message: message});
                });

                socket.on("message_added", function(){
                    $("#message").val('');
                });

                socket.on("new_message_added", function(data){
                    $(".chat").html('');
                    for (var message in data.messages){
                        $(".chat").append('<p>'+ data.messages[message].name +': '+data.messages[message].message+'</p>');
                    }
                });

                socket.on("disconnect_user", function(data){

                    var id = JSON.stringify(data.disconnect_id);
                    var id2 = id.slice(3,-1);

                    $("."+id2+"").css('color', '#888').css('font-style', 'italic');
                });

            })
        </script>
    </head>
    <body>
        <div class="container div_border">
            <h3>Conversation Board</h3>
            <div class=" div_border">
                <h5>Users:</h5>
                <div class="users container">

                </div>
            </div>
            <div class="chat_room">
                <div class="two columns user">

                </div>
                <div class="ten columns chat">

                </div>
            </div>

            <form id="message_form" action="index.html" method="post">
                <input type="hidden" id="userID" name="userID" >
                <textarea class="u-full-width" id="message" name="message"></textarea>
                <input class="button-primary right" type="submit" value="Submit">
            </form>

        </div>
    </body>
</html>
